# Markdown转换为PDF渲染程序需求文档

## 一、项目概述

本项目旨在开发一套基于Rust + Actix Web后端、React 19 + Tailwind CSS前端技术栈的Markdown转PDF本地渲染程序，支持Mermaid图表渲染，具备安全性、可扩展性和良好的用户体验。程序允许用户通过内置Markdown编辑器输入或上传Markdown文件，实时预览并一键转换为高质量PDF，支持Mermaid图表的正确渲染和样式定制。系统采用Tauri进行跨平台打包分发，确保在Windows、Mac OS、Linux等主流操作系统下均可流畅运行。

## 二、功能需求

### （一）用户交互功能

1. **Markdown编辑器**：提供一个Markdown编辑器，方便用户通过复制粘贴的方式输入Markdown内容，同时支持对已输入的Markdown内容进行编辑和调整。编辑器应具备基本的文本编辑功能，如撤销、重做、复制、粘贴等。
2. **文件上传**：用户能够通过界面选择本地的Markdown文件进行上传。支持常见的Markdown文件格式，如 `.md`、`.markdown`。
3. **实时预览**：在编辑器中输入或上传Markdown文件后，系统应实时在界面展示文件的渲染效果，包括文本格式、代码块、图片、链接等。对于包含Mermaid图表的Markdown文件，应正确渲染Mermaid图表。
4. **转换按钮**：提供一个“转换为PDF”的按钮，用户点击后，系统将当前预览的Markdown内容转换为PDF文件。
5. **下载功能**：转换完成后，用户能够在界面直接下载生成的PDF文件。

### （二）Mermaid支持功能

1. **图表渲染**：能够正确识别Markdown文件中的Mermaid代码块，并将其渲染为相应的图表，如流程图、时序图、甘特图等。
2. **图表样式定制**：支持对Mermaid图表的样式进行定制，如颜色、字体、线条样式等。用户可以通过简单的配置选项来调整图表的外观。

### （三）系统管理功能

1. **日志记录**：记录用户的文件上传、内容输入、转换操作等信息，包括操作时间、文件名称（如有）、转换结果等。方便后续的系统维护和问题排查。
2. **错误处理**：当用户输入的Markdown内容格式不正确、Mermaid代码无法解析或转换过程中出现其他错误时，系统应给出明确的错误提示信息，帮助用户定位问题。

## 三、非功能需求

### （一）性能需求

1. **响应时间**：编辑器输入响应时间≤1秒，文件上传≤3秒，实时预览更新时间≤2秒。
2. **转换时间**：小型Markdown文件（<1MB）转换为PDF≤5秒，大型文件（≥1MB）≤10秒。
3. **资源占用**：系统CPU和内存占用应低于同类桌面应用平均水平，单次转换峰值内存占用≤500MB。
4. **并发处理**：支持至少3个并发转换任务，互不影响。

### （二）安全性与可扩展性需求

1. **安全性**：前后端通信采用本地IPC，防止外部恶意访问；对上传文件进行格式校验和内容安全检测，防止XSS、代码注入等攻击；日志中不记录敏感内容。
2. **可扩展性**：系统模块化设计，支持后续集成更多Markdown扩展、图表类型或导出格式（如HTML、DOCX等）。

### （三）兼容性需求

1. **操作系统兼容性**：支持Windows 10及以上、Mac OS 10.15及以上、主流Linux发行版。
2. **文件格式兼容性**：支持.md、.markdown等主流Markdown文件格式，兼容常见图片（PNG、JPG、SVG）、代码高亮、表格等。

### （四）日志与错误处理

1. **日志记录**：详细记录用户操作（如文件上传、内容编辑、转换、下载）、系统异常、性能指标等，日志包含操作时间、文件名、用户行为、转换结果、异常堆栈等，便于问题追踪和系统维护。
2. **错误处理**：对Markdown格式错误、Mermaid解析失败、PDF生成异常等情况，系统应弹窗或界面提示明确错误信息，并在日志中详细记录，支持用户导出错误报告。
3. **数据流程异常处理**：各模块间数据传递均需校验，发现异常立即中断流程并反馈错误，防止错误扩散。

### （五）可维护性与文档

1. **需求文档维护**：项目进展和需求变更时，及时更新需求文档，确保准确性和完整性。
2. **用户手册**：系统开发完成后，编写详细用户手册，包括功能介绍、操作流程、常见问题、故障排查等。
3. **技术文档**：编写系统架构、模块设计、接口说明、日志格式、异常处理流程等技术文档，便于后续维护和扩展。

### （二）兼容性需求

1. **操作系统兼容性**：支持常见的操作系统，如Windows、Mac OS、Linux等。

### （三）易用性需求

1. **界面设计**：界面应简洁美观，操作流程清晰易懂，支持暗色/亮色主题切换，布局合理，Markdown编辑器与预览区域并列展示，便于用户查看和操作。
2. **帮助文档**：提供详细的帮助文档，包括系统使用方法、常见问题、Markdown语法、Mermaid图表编写规范、PDF导出说明等，支持内置帮助和在线文档两种形式，帮助用户快速上手。

## 四、系统架构

### （一）整体架构

本系统为单机应用，采用Tauri作为打包框架，将前端和后端整合为一个本地应用程序。前端负责用户交互和界面展示，后端负责Markdown文件的处理和PDF文件的生成。具体架构如下：

1. **前端**：使用Tailwind CSS框架构建用户界面，通过JavaScript与后端进行数据交互。主要包括Markdown编辑器组件、实时预览组件、转换按钮和下载组件。
2. **后端**：基于Rust + Actix Web开发，负责处理前端请求，解析Markdown、渲染Mermaid图表并生成PDF文件。后端实现高性能、低资源占用，并内置安全校验、日志记录和错误处理机制。

### （二）模块划分

1. **Markdown输入模块**：负责接收用户在编辑器中的输入内容或上传的Markdown文件。
2. **Markdown解析模块**：对输入的Markdown内容进行解析，提取文本内容、代码块、图片链接等信息。
3. **Mermaid渲染模块**：识别Markdown内容中的Mermaid代码块，并将其渲染为图表。
4. **PDF生成模块**：将解析后的Markdown内容和渲染后的Mermaid图表转换为PDF文件。
5. **日志记录模块**：记录用户的操作信息和系统的运行状态。
6. **错误处理模块**：捕获系统运行过程中出现的错误，并给出相应的错误提示信息。

## 五、数据流程

1. 用户在Markdown编辑器中输入内容或通过界面上传Markdown文件。
2. 前端将输入内容或文件发送到后端的Markdown输入模块。
3. Markdown输入模块将内容传递给Markdown解析模块进行解析。
4. Markdown解析模块解析内容，提取Mermaid代码块并发送给Mermaid渲染模块。
5. Mermaid渲染模块将Mermaid代码块渲染为图表，并将结果返回给Markdown解析模块。
6. Markdown解析模块将解析后的内容和渲染后的图表发送给PDF生成模块。
7. PDF生成模块生成PDF文件，并将文件路径返回给前端。
8. 前端显示转换成功的提示信息，并提供下载链接供用户下载PDF文件。
9. 日志记录模块记录整个操作过程的信息。

## 六、界面设计

### （一）首页

1. **Markdown编辑器区域**：占据页面较大部分，方便用户输入和编辑Markdown内容。
2. **实时预览区域**：与编辑器区域相邻，实时显示Markdown内容的渲染效果。
3. **文件上传按钮**：提供一个按钮，允许用户选择本地的Markdown文件进行上传。
4. **转换按钮**：位于页面显著位置，方便用户点击进行转换操作。

### （二）下载页面

1. **下载链接**：显示生成的PDF文件的下载链接，用户点击即可下载。
2. **操作提示**：提供一些操作提示信息，如文件保存路径、文件大小等。

## 七、性能需求

1. **响应时间**：系统应在短时间内响应用户的操作，如编辑器输入、文件上传、预览和转换等。具体要求如下：

    - 编辑器输入响应时间不超过1秒。
    - 文件上传响应时间不超过3秒。
    - 实时预览更新时间不超过2秒。
    - PDF转换时间根据文件大小而定，小文件（小于1MB）不超过5秒，大文件（大于1MB）不超过10秒。

2. **资源占用**：在正常使用情况下，系统的CPU和内存占用应保持在合理范围内，不影响用户的其他操作。

## 八、兼容性需求

1. **操作系统兼容性**：支持常见的操作系统，如Windows 10及以上、Mac OS 10.15及以上、Linux（主流发行版）等。

## 九、文档维护

1. **需求文档更新**：随着项目的进展和需求的变化，及时更新需求文档，确保文档的准确性和完整性。
2. **用户手册编写**：在系统开发完成后，编写详细的用户手册，包括系统的功能介绍、使用方法、常见问题解答等，帮助用户更好地使用系统。
3. **技术文档编写**：编写技术文档，包括系统架构、模块设计、代码实现等方面的内容，方便后续的系统维护和扩展。
